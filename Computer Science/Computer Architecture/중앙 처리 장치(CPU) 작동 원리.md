# 중앙 처리 장치(CPU) 작동 원리

- 참고 자료: https://www.youtube.com/watch?v=Fg00LN30Ezg&t=1220s

1. **중앙 처리 장치(CPU)**

   - 컴퓨터에서 가장 핵심적인 역할을 수행하는 부분으로서 '인간의 두뇌' 역할
   - 중앙 처리 장치는 크게 연산 장치(ALU), 제어 장치(CU), 레지스터 3가지로 나누어진다.

   

2. **연산 장치(ALU)**

   - '덧셈', '뺄셈', '곱셈', '나눗셈' 등의 **산술 연산**과 'AND', 'OR', 'NOT'등의 **논리 연산**을 수행(두 가지의 연산을 모두 수행하므로 **산술 논리 연산 장치**라고도 말한다)
   - 연산 장치는 연산에 필요한 데이터를 **레지스터**에서 가져오고, 연산 결과를 다시 **레지스터**로 보내 저장

   

3. **제어 장치(CU)**

   - 명령어를 순서대로 실행할 수 있도록 제어하는 장치
   - 주 기억 장치에서 명령어를 꺼내 (명령어 레지스터에 저장하여 해당 명령어를) 해석하고, 해석한 결과에 따라 명령어 실행에 필요한 제어 신호를 기억 장치, 연산 장치, 입출력 장치로 보냄
   - 기억 장치, 연산 장치, 입출력 장치가 보낸 신호를 받아 다음에 수행할 동작을 결정

   

4. **레지스터**

   - 중앙 처리 장치의 속도와 비슷한 고속의 기억 장치

   - 명령어 주소, 명령어 코드, 연산에 필요한 데이터, 연산 결과 등을 임시로 저장

   - 용도에 따라 범용 레지스터와 특수 목적 레지스터로 구분

     - **범용 레지스터** : 연산에 필요한 데이터나 연산 결과를 임시로 저장

     - **특수 목적 레지스터 예시**

       > **프로그램 카운터(PC)** : 다음에 수행할 명령어의 주소를 저장
       >
       > **메모리 주소 레지스터(MAR)** : 읽기와 쓰기 연산을 수행할 주기억장치의 주소를 저장
       >
       > **메모리 버퍼 레지스터(MBR)** : 주기억장치에서 읽어온 데이터나 주기억장치에 저장할 데이터를 임시로 저장.
       >
       > **명령어 레지스터(IR)** : 메모리 버퍼 레지스터에 저장된 명령어를 저장
       >
       > **누산기(AC)** : 메모리 버퍼 레지스터 중 연산에 사용될 데이터나 연산 결과를 임시로 저장, 이후 최종적으로 저장할 데이터는 메모리 버퍼 레지스터를 통해 주 기억 장치에 저장

   

5. **중앙 처리 장치 동작 과정**

   0. 명령어 세트 : CPU가 실행할 명령어의 집합

      > 연산 코드(Operation Code, 명령의 내용 / 제어 장치가 수행하는 연산) + 피연산자(Operand, 명령을 수행하는데 필요한 데이터의 저장 위치)

   1. 인출 : 주 기억 장치에 저장된 값을 레지스터로 가져오는 과정
      - **프로그램 카운터(PC)**에는 다음에 가져와야 할 메모리 주소가 저장되어 있다. 해당 데이터는 **메모리 주소 레지스터**로 이동하게 된다.
      - **메모리 주소 레지스터**의 주소로부터 가져온 해당 데이터는 **메모리 버퍼 레지스터**에 저장하게 된다.

   2. 해석 : 메모리로부터 가져온 데이터를 제어 장치로 이동시켜 해석하는 과정

      - **메모리 버퍼 레지스터**에 들어온 데이터가 '명령어' 일 경우, 해당 명령은 **명령어 레지스터**로 이동한다.

      - 그 후 **프로그램 카운터에** 2(16bit 데이터 기준)의 숫자가 더해진다 > 다음 메모리 주소를 갱신
        (메모리는 1줄 당 8bit의 데이터를 갖게 되므로 16bit 데이터를 처리하는 경우 2줄이 사용되므로 2가 더해진다. 동일한 원리로 32bit는 4줄, 64bit는 8줄이므로 각각 **프로그램 카운터**에 4, 8이 더해지게 된다.)

      - **명령어 레지스터**에 저장된 명령은 제어장치로 이동되어 해석

   3. 실행 : 산술 논리 장치(ALU)에서 계산되는 과정 / 모든 과정은 제어 장치에 의해 컨트롤 된다.

      - **제어 장치**에서 해석된 명령이 수행된다. (ADD, LOAD 등)

      - 만일 **제어 장치**의 명령이 LOAD일 경우 명령문 내 메모리 주소에서 데이터를 '인출'하여 **메모리 버퍼 레지스터**에 저장된다. 가져온 데이터는 명령어가 아닌 데이터이므로 **누산기 레지스터**에 저장되게 된다.

      - 만일 **제어 장치**의 명령이 ADD 등의 연산 명령일 경우, **누산기 레지스터**의 데이터는 연산을 위해 **연산 장치(ALU)**로 이동하게 되고, 연산 명령어 내의 메모리 주소에서 동일하게 데이터를 인출하여 **연산 장치(ALU)**로 이동시켜 연산을 수행한다. 해당 결과값은 다시 누산기 레지스터에 저장된다.

   4. 저장 :  메모리에 데이터를 저장하는 과정
      - 만일 **제어 장치**의 명령어가 저장일 경우, **누산기 레지스터**에 저장된 데이터는 **메모리 버퍼 레지스터**로 이동하게 되고 이후 명령어 내의 메모리 주소로 **메모리 버퍼 레지스터**의 데이터를 저장하게 된다. 

   - 실제 CPU는 이 단계들을 세분화하여 동작하는데 이렇게 분리된 프로세스를 **스레드**라고 한다.
